'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.PanelCtrl=exports.GlobeCtrl=undefined;var _sdk=require('app/plugins/sdk');var _angular=require('angular');var _angular2=_interopRequireDefault(_angular);require('./Cesium/Widgets/widgets.css!');require('./css/3d-globe-panel.css!');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}/* global _, window */require('./Cesium/Cesium.js');var BASE_URL='/public/plugins/satellogic-3d-globe-panel';var Cesium=window.Cesium;var panelSettings={url:'',bingKey:''};window.CESIUM_BASE_URL=BASE_URL+'/Cesium/';// Main Globe Control
var GlobeCtrl=exports.GlobeCtrl=function(_PanelCtrl){_inherits(GlobeCtrl,_PanelCtrl);function GlobeCtrl($scope,$injector,$rootScope){_classCallCheck(this,GlobeCtrl);var _this=_possibleConstructorReturn(this,(GlobeCtrl.__proto__||Object.getPrototypeOf(GlobeCtrl)).call(this,$scope,$injector));_this.onInitEditMode=function(){_this.addEditorTab('Options','public/plugins/satellogic-3d-globe-panel/editor.html',2);};_this.registerViewer=function(viewer){_this.viewer=viewer;};_this.refresh=function(){if(_this.panel.bingKey){Cesium.BingMapsApi.defaultKey=_this.panel.bingKey;}if(_this.viewer&&_this.panel.url){// Get global from/to
var _this$timeSrv$timeRan=_this.timeSrv.timeRange(),from=_this$timeSrv$timeRan.from,to=_this$timeSrv$timeRan.to;// Replace querystring with dashboard's templates and from/to
var url=_this.templateSrv.replace(_this.panel.url+'?'+_this.panel.query).replace(/\$timeFrom/g,from.valueOf()).replace(/\$timeTo/g,to.valueOf());_this.viewer.dataSources.removeAll(true);_this.viewer.dataSources.add(Cesium.CzmlDataSource.load(url)).then(null,function(err){_this.rootScope.appEvent('alert-error',['Plugin Error','Error while retrieving CZML data: '+err]);});}};_this.rootScope=$rootScope;_this.panel=_.defaults(_this.panel,panelSettings);_this.timeSrv=$injector.get('timeSrv');_this.templateSrv=$injector.get('templateSrv');_this.events.on('refresh',_this.refresh);_this.events.on('init-edit-mode',_this.onInitEditMode);_this.refresh();return _this;}return GlobeCtrl;}(_sdk.PanelCtrl);GlobeCtrl.templateUrl='module.html';// Register the globe directive
_angular2.default.module('grafana.directives').directive('gfSatellogic3dGlobe',function(){return{template:'<div class="cesiumContainer"></div>',replace:true,restrict:'E',link:function link(scope,element){var STARS_FOLDER=BASE_URL+'/Cesium/Assets/Textures';var viewer=new Cesium.Viewer(element[0],{skyBox:new Cesium.SkyBox({sources:{positiveX:STARS_FOLDER+'/SkyBox/tycho2t3_80_px.jpg',negativeX:STARS_FOLDER+'/SkyBox/tycho2t3_80_mx.jpg',positiveY:STARS_FOLDER+'/SkyBox/tycho2t3_80_py.jpg',negativeY:STARS_FOLDER+'/SkyBox/tycho2t3_80_my.jpg',positiveZ:STARS_FOLDER+'/SkyBox/tycho2t3_80_pz.jpg',negativeZ:STARS_FOLDER+'/SkyBox/tycho2t3_80_mz.jpg'}}),animation:false});viewer.scene.globe.enableLighting=true;scope.ctrl.registerViewer(viewer);}};});exports.PanelCtrl=GlobeCtrl;